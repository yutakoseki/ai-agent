# テスト戦略（最低限のカバレッジ案）

## スコープ
- コンポーネント/ユニット: Next.js UI, Route Handler のロジック、ヘルパー関数。
- 疎通/API: BFF の主要エンドポイント（認証/RBAC/テナント終端含む）の疎通。
- E2E: クリティカルフロー（ログイン→テナント選択→代表的なエージェント実行→結果表示）。
- AgentCore: ハンドラ/ワーカーのユニット + キュー経由の疎通（最小シナリオ）。

## ツール例
- コンポーネント/ユニット: Jest/Testing Library (Next.js用設定), Node: ts-jest or swc
- E2E: Playwright（CI用のheadless）、テストユーザ/テナントのシードを用意
- Python: pytest + ruff（lint）でユニット、キュー疎通の軽量テスト

## カバレッジの目安（初期）
- コンポーネント/ユニット: 主要ロジック/コンポーネントで 50–60% 目標（最初はクリティカル中心）
- E2E: クリティカルフロー 2–3 本から開始（ログイン、代表的な業務レシピ実行）
- AgentCore: 代表的なエージェント2–3種の成功/失敗パス + リトライ/冪等性確認

## フィクスチャ/シード
- テナント/ユーザ/ロール/エンタイトルメントの最小シードを用意し、テスト環境で再現可能にする。
- 外部コネクタはモック/スタブで切り離し、実コールを禁止（例外的に疎通用環境がある場合のみ許可）。

## CIでの実行方針
- 影響範囲のみ実行（Turborepo等で差分判定）。PRでは lint/test/E2E(軽量) を必須。
- E2Eは短時間で終わるシナリオに絞り、長いシナリオは nightly/手動トリガに分離。

## レポート
- テスト結果とカバレッジをアーティファクト化し、閾値を設定（下回った場合は警告）。
- 失敗時はスクリーンショット/動画（Playwright）を保存し、デバッグ容易性を確保。



