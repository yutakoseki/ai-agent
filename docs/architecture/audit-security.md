# 監査ログ / 可観測性 / セキュリティガードレール（初期案）

## 監査ログ
- 記録項目: 誰が / どのテナントで / どのエージェントを / どの入力で / どの結果になったか。承認ゲートの承認者・時刻・差分。
- PII/機密はマスキング or ハッシュ化し、生データは残さない。必要に応じて再識別不能なトークンを利用。
- 保存期間を定義し、削除要求/保持ポリシーに従ってローテーション。

## 可観測性
- トレースID/ジョブIDを BFF→AgentCore→外部コネクタまで伝搬し、ログを相関付ける。
- メトリクス: 成功/失敗数、リトライ回数、レイテンシ、キュー滞留、エラー分類（入力不足/認可不足/外部依存失敗/システム異常）。
- アラート: RPS/失敗率/滞留時間/クォータ枯渇/異常レイテンシで閾値通知。
- ログ構造: JSON ログを推奨し、テナントID/トレースID/ユーザID/エージェントIDを必ず含める。

## セキュリティガードレール
- 認証/RBAC/テナントは BFF で終端。AgentCore でも `tenant_id` と許可スコープを二重チェック。
- write系エージェントは承認ゲートをデフォルトで挿入可にし、実行者と承認者を分離。
- コネクタスコープは read/write/notify を明示し、writeは分離したエージェントに限定。最小権限を徹底。
- ネットワーク: 管理系エンドポイントは IP 制限＋Auth、CORS/CSRF 設定を適用。WAF/IDS/DDoS 対策を検討。
- 依存/ビルド: SBOM と脆弱性スキャンを CI で実施し、リードタイムを定義。ロックファイルを維持。
- データ終了: 返却形式・削除期限・削除証明の有無を定義。漏えい時の報告/補償手順を明記。




